<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content='width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no' name='viewport'>
    <title>预定</title>
    <link rel="icon" type="image/png" sizes="32x32" href="../images/favicon-32x32.png">
    <!----------------Global css------------------->
    <link rel="stylesheet" href="../css/bootstrap.css">
    <link rel="stylesheet" href="../css/font-awesome.min.css">
    <link rel="stylesheet" href="../vendors/revolution-slider/css/layers.css">
    <link rel="stylesheet" href="../vendors/revolution-slider/css/navigation.css">
    <link rel="stylesheet" href="../vendors/revolution-slider/css/settings.css">
    <link rel="stylesheet" href="../vendors/imagehover/css/imagehover.min.css">
    <link rel="stylesheet" href="../vendors/animate/animate.min.css">
    <link rel="stylesheet" href="../vendors/iCheck/css/all.css">
    <link rel="stylesheet" href="../vendors/sweetalert2/css/sweetalert2.min.css">
    <!----------------custo css----------------->
    <link rel="stylesheet" href="../css/custom.css">
    <link rel="stylesheet" href="../lib/layui/css/layui.css" media="all">
    <script  type="text/javascript" src="../js/jquery.min.js"></script>

    <script>
        //页面加载后，异步查询登录状态，如果登陆过，则 显示用户名信息，
        //如果没有登录 则显示 登录 和  注册 按钮
        $().ready(function (){
            // alert(111);
            // console.log("E,,,,,,");
            $.ajax({
                type:'post',
                url:'../beforeUserLogin/loginCheck',
                dataType:"json",
                success:function (data) {
                    //
                    // console.log(data);
                    if (data.length==1&&data[0]==1) {
                        var html=" ";

                        html+='     <span class="signin" data-toggle="modal" data-target="#myModal"> ';
                        html+='     <span class="hidden-xs">登录</span> ';
                        html+='     <i class="fa fa-sign-in visible-xs-block" aria-hidden="true"></i> ';
                        html+='     </span> ';
                        html+='     <span class="register" data-toggle="modal" data-target="#myModal"> ';
                        html+='    <span class="hidden-xs">注册</span> ';
                        html+='     <i class="fa fa-user-plus visible-xs-block" aria-hidden="true"></i> ';
                        html+='    </span> ';
                        $("#beforeLogin").append(html);
                    }
                    if (data.length==2){
                        var html=" ";
                        //   console.log(data);
                        html+='     <span  > ';
                        html+='     <span >尊敬的会员：</span> ';

                        html+='     </span> ';
                        html+='     <span  > ';
                        html+='    <span >'+ data[0]+'</span> ';
                        html+='    <span ><a href="../beforeUserLogin/singout">注销登陆</a></span> ';
                        html+='    </span> ';
                        $("#beforeLogin").append(html);
                    }
                }

            })
        })

        var InterValObj; //timer变量，控制时间
        var count = 5; //间隔函数，1秒执行
        var curCount;//当前剩余秒数
        function getletterMessage() {

            curCount = count;
            //设置button效果，开始计时
            $("#btnSendCode").attr("disabled", "true");
            $("#btnSendCode").val( "重新发送"+curCount);
            InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
            $.ajax({
                type:'post',
                url:'../send/email',
                data:{"address":$('#Email_id').val()},
                dataType:"json",
                success:function (data) {
                    alert("发送成功");
                }
            })
        }
        //发送验证码  按钮  处理函数
        function SetRemainTime() {
            if (curCount == 0) {
                window.clearInterval(InterValObj);//停止计时器
                $("#btnSendCode").removeAttr("disabled");//启用按钮
                $("#btnSendCode").val("发送验证码");
            }
            else {
                curCount--;
                $("#btnSendCode").val( "重新发送"+curCount);
            }
        }


    </script>

</head>
<body>
<!--------------------Preloader-------------->
<div class="preloader" style="position:fixed;
    width:100%;
    height:100%;
    top:0;
    left:0;
    z-index:100000;
    backface-visibility: hidden;
    background: #ffffff;">
    <div style=" width: 50px;
    height: 50px;
    position: absolute;
    left: 50%;
    top: 50%;
    background-position: center;
    margin:-25px 0 0 -25px;">
        <img src="../images/loader.gif" alt="loading...">
    </div>
</div>
<!------------------Preloader end------------------->
<div class="tp-header">
    <!--动态显示内容-->
    <div class="container" id="headMessage">
        <div class="row">
            <div class="col-xs-7 col-md-6">

            </div>
            <!--登录前显示的内容-->
            <div class="col-xs-5 col-md-6 text-right" id="beforeLogin">

            </div>
            <!--登录前显示的 结束-->

        </div>
    </div>
    <!--动态显示内容 结束-->
</div>
<header>
    <div class="container">
        <nav class="navbar navbar-default">
            <div class="navbar-header">
                <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#myMegamenu"><span
                        class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>

                </button>
                <a class="navbar-brand" href="/dinner/locationTo/bbbf">
                    <img src="../images/3.png" class="img-responsive" alt="company-logo">
                </a>
            </div>
            <div class="collapse navbar-collapse navbar-right" id="myMegamenu">
                <ul class="nav navbar-nav">
                    <li class="list2"><a href="/dinner/locationTo/bbbf" class="hvr-underline-from-center">首页</a></li>
                    <li class="list2"><a href="/dinner/before/food" class="hvr-underline-from-center">特色美食</a></li>
                    <li class="list2"><a href="/dinner/locationTo/bbbc" class="hvr-underline-from-center">餐桌预定</a></li>
                    <!--<li class="list2"><a href="/dinner/locationTo/bbbb" class="hvr-underline-from-center">联系我们</a></li>-->
                </ul>
            </div>

        </nav>
    </div>
</header>
<!--Login And Register Modal-->
<div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <br>
            <div class="bs-example bs-example-tabs">
                <ul id="myTab" class="nav nav-tabs ">
                    <li id="signin_tab" class="active"><a href="#signin" data-toggle="tab">登录</a></li>
                    <li id="reg_tab"><a href="#signup" data-toggle="tab">注册</a></li>
                </ul>
            </div>
            <div class="modal-body">
                <div id="myTabContent" class="tab-content">
                    <div class=" signin tab-pane fade active in" id="signin">
                        <!--第一个表单开始-->
                        <form class="form-horizontal" action="../beforeUserLogin/CodeCheck" method="post">
                            <fieldset>
                                <div class="control-group section-top-10">
                                    <label class="control-label" for="userid"><span
                                            class="glyphicon glyphicon-user text-primary"></span> 用户名:</label>
                                    <div class="controls">
                                        <input id="userid" name="username" type="text" class="form-control input-medium aa"
                                               phone="phone"   placeholder="请输入用户名" >
                                    </div>
                                </div>
                                <div class="control-group section-top-10">
                                    <label class="control-label" for="passwordinput"><span
                                            class="glyphicon glyphicon-eye-open text-primary"></span> 密码 :</label>
                                    <div class="controls">
                                        <input type="password" id="passwordinput" name="password"
                                               password="password"    class="form-control input-medium aa" placeholder="请输入密码" >
                                    </div>
                                </div>
                                <div class="control-group section-top-10">
                                    <label class="control-label" for="verifyCode"><span
                                            class="glyphicon glyphicon-hdd text-primary"></span> 验证码 :
                                        <span class="code_img"> <img
                                                src="../VerCode/getVerifyCode"
                                                width="110" height="40" id="verifyCodeImage">
                                        </span>
                                        <span> <a id="changeVerifImageRegister"
                                                  onclick="changeImage()">换一张</a>
                                         </span>
                                    </label>
                                    <div class="controls">
                                        <input type="text" id="verifyCode" name="invite"
                                               verifyCode="verifyCode"     class="form-control input-medium aa" placeholder="请输入图片上的内容.." >
                                    </div>
                                </div>
                                <div class="checkbox">
                                    <label><input type="checkbox" class="blue">记住我 &nbsp;&nbsp;&nbsp;</label>
                                </div>
                                <div class="control-group">
                                    <div class="controls section-top-10">
                                        <a id="signin_btn" name="signin1" class="btn btn-success form-control">登录
                                        </a>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                        <!--第一个表单 结束-->
                    </div>
                    <div class="tab-pane fade signup" id="signup">
                        <!--第二个表单开始-->
                        <form class="form-horizontal" role="form"     method="post">
                            <fieldset>
                                <div class="control-group section-top-10" id="div1">
                                    <label for="user"><span class="glyphicon glyphicon-user text-primary"></span> 用户名/手机号
                                        :</label>
                                    <div class="controls">

                                        <input id="user" name="phone" class="form-control input-large aa" req="req" phone="phone" placeholder="请输入您的手机号码.." >
                                    </div>
                                </div>
                                <div class="control-group section-top-10" id="div2">
                                    <label class="control-label" for="Email_id"> <span class="glyphicon glyphicon-envelope text-primary"></span> 邮箱 :</label>
                                    <div class="controls">
                                        <input id="Email_id" name="email"  class=" form-control input-large aa" email="email" req="req" placeholder="abcdef@xyz.com" >
                                    </div>
                                </div>
                                <div class="control-group section-top-10" id="div3">
                                    <label for="password"><span
                                            class="glyphicon glyphicon-eye-open text-primary"></span>
                                        密码 :</label>
                                    <div class="controls">
                                        <input id="password" name="password" class="form-control input-large aa"
                                               password="password" req="req"  type="password" placeholder="请输入你想用的密码" >

                                    </div>
                                </div>
                                <div class="control-group section-top-10">
                                    <label class="control-label" for="reenterpassword"><span
                                            class="glyphicon glyphicon-repeat text-primary"></span> 确认密码密码:</label>
                                    <div class="controls">
                                        <input id="reenterpassword" class="form-control input-large aa"
                                               repassword="repassword"   name="repassword" type="password" req="req" placeholder="保证两次输入的密码相同"
                                        >
                                    </div>
                                </div>
                                <div class="control-group section-top-10" id="div4">
                                    <label class="control-label" for="letterCode"><span
                                            class="glyphicon glyphicon-envelope text-primary"></span> 邮箱验证码:
                                        <input type="button"  id="btnSendCode"  onclick="getletterMessage()" value="获取验证码" />
                                    </label>
                                    <div class="controls">
                                        <input id="letterCode" class="form-control input-large aa"
                                               name="letterCode" letterCode="letterCode" type="text" placeholder="收到的邮箱验证码.."
                                        >
                                    </div>
                                </div>
                                <div class="control-group section-top-10">
                                    <label class="control-label" for="confirmsignup"></label>
                                    <div class="controls">
                                        <a id="confirmsignup"
                                           class="btn btn-success form-control">提交注册
                                        </a>
                                    </div>
                                </div>
                            </fieldset>
                        </form>
                        <!--第二个表单结束-->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger" data-dismiss="modal">取消</button>
            </div>
        </div>
    </div>
</div>
<!--Login And Register Modal-->
<!--------------About section---------->
<div class="container">
    <div class="row">
        <div class="col-sm-6 col-sm-offset-3 text-center m-t-50">
            <h2 class="text-center heading underline">和平饭店</h2>
            <p>感谢您的光临.
            </p>
        </div>
    </div>
    <div class="row m-t-50">
        <div class="col-sm-5">
            <img src="../images/about_img.png" class="img-responsive" alt="about_image">
            <br/>
        </div>
        <div class="col-sm-7">
            <div class="row">
                <div class="col-xs-12 text-justify">
		                        <form class="form" method="post">
		                            <div class="col-xs-12"><h4 class="heading_left">预订信息 </h4></div>
		                            <div class="form-group col-xs-12 section-top-10">
		                            	姓名
		                                <input type="text" class="form-control" name="name" placeholder="姓名 *" id="name" required="required">
		                             </div>
		                            <div class="clearfix visible-sm-block visible-md-block visible-xs-block"></div>
		                            <div class="form-group col-sm-6 col-xs-12">
		                            	邮箱
		                                <input type="email" class="form-control" name="email" placeholder="邮箱 *" id="email" required="required">
		                            </div>
		                            <div class="form-group col-sm-6 col-xs-12">
		                            	手机号
		                                <input type="text" class="form-control" name="number" pattern="[0-9]{11}"
		                                       placeholder="手机号码 *" id="phone"  required="required">
		                            </div>
                                    <div class="form-group col-sm-6 col-xs-12">
                                        桌号
                                        <select class="form-control" id="number">
                                            <option value="1">大厅1号桌</option>
                                            <option value="2">大厅2号桌</option>
                                            <option value="3">大厅3号桌</option>
                                            <option value="4">大厅4号桌</option>
                                            <option value="5">大厅5号桌</option>
                                            <option value="6">大厅6号桌</option>
                                            <option value="7">包间1号桌</option>
                                            <option value="8">包间2号桌</option>
                                            <option value="9">包间3号桌</option>
                                            <option value="10">包间4号桌</option>
                                            <option value="11">包间5号桌</option>
                                            <option value="12">包间6号桌</option>
                                        </select>
                                    </div>
                                    <div class="form-group col-sm-6 col-xs-12">
                                        预定时间
                                        <input type="text" class="layui-input" id="date" required="required" placeholder="请选择预定日期 *">
                                    </div>
		                            <div class="clearfix visible-sm-block visible-md-block visible-xs-block"></div>
		                            <div class="col-xs-12 form-group">
		                              	 备注 <textarea class="form-control" rows="4" name="message" placeholder="备注信息（选填） *"
		                                          id="message"></textarea>
		                            </div>
		                            <div class="clearfix visible-sm-block visible-md-block visible-xs-block"></div>
		                            <div class="col-md-12 text-center section-bottom-15">
		                                <button id="save" class="btn btn-success">预定</button>
		                            </div>
		                        </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-------------About section end-->


<script src="../js/jquery.min.js"></script>
<script src="../js/bootstrap.min.js"></script>
<script src="../vendors/revolution-slider/js/jquery.themepunch.revolution.min.js"></script>
<script src="../vendors/revolution-slider/js/jquery.themepunch.tools.min.js"></script>
<script src="../vendors/iCheck/js/icheck.js"></script>
<script src="../vendors/countup/js/countUp.min.js"></script>
<script src="../vendors/sweetalert2/js/sweetalert2.min.js"></script>
<script src="../vendors/jribbble/js/jribbble.min.js"></script>
<!----------------------page Level Js-------------------------->
<script src="../js/custom.js"></script>
<script src="../lib/layui/layui.js"></script>
<script>
    /*layui日期选择*/
    layui.use('laydate', function(){
        var laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#date',//指定元素
            min: 0, //最小值,今天
            max: 7 //最大值
        });
    });

	$("#save").click(function(){
        var name = $("#name").val();
        var email = $("#email").val();
        var phone = $("#phone").val();
        var number = $("#number").val();
        var date = $("#date").val();
        var message = $("#message").val();
        $.ajax({
            url:"/dinner/reserve",
            type: "post",
            datatype:"json",
            data:{"name":name,"email":email,"phone":phone,"number":number,"date":date,"message":message},
        })
        alert("预定成功");
        window.location.href = "/dinner/locationTo/bbbf";
	})

    //图片验证码
    function genTimestamp() {
        var time = new Date();
        return time.getTime();
    }
    function changeImage() {
        $('#verifyCodeImage').attr('src',
            '../VerCode/getVerifyCode?timestamp=' + genTimestamp());
    }
    // 表单校验
    var quanju=false;
    $(".aa").blur(function(){

        var jQ=$(this);
        var value=jQ.val();
        var email=jQ.attr("email");
        var phone=jQ.attr("phone");
        var password=jQ.attr("password");
        var repassword=jQ.attr("repassword");

        var req=jQ.attr("req");
        //  console.log(req);
        var state=true;
        if (req=="req"){
            if (value==null||value.trim()==""){
                state=false
            }
        }
        if (phone=="phone"){
            var reg=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/;
            if (!reg.test(value)){
                state=false
            }
        }
        if (email=="email"){
            var reg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            if (!reg.test(value)){
                state=false
            }
        }
        if (password=="password"){
            var reg=/^.{3,20}$/;//长度为3-20的所有字符
            if (!reg.test(value)){
                state=false
            }
        }
        if (repassword=="repassword"){
            // var reg=/^.{3,20}$/;//长度为3-20的所有字符
            var pwd1=$("#password").val();
            var repwd=$("#reenterpassword").val();

            if (pwd1!=repwd){
                state=false
            }
        }
        if (email=="email"){
            var reg=/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            if (!reg.test(value)){
                state=false
            }
        }
        if(state==false){
            jQ.attr("style","background:red");
            quanju=false;
        }else{
            jQ.attr("style","background:white");
            quanju=true;
        }
    });
    //注册
    $("#confirmsignup").click(function(){
        if(quanju){ //  quanju=true;
            $(".aa").each(function(){
                $(".aa").trigger("blur");
            });
            if(quanju==true){
                $.ajax({
                    type:'post',
                    url:'../register/userRegister',
                    dataType:"json",
                    data:{"phone":$('#user').val(),
                        "email":$('#Email_id').val(),
                        "password":$('#password').val(),
                        "reenterpassword":$('#reenterpassword').val(),
                        "letterCode":$('#letterCode').val()
                    },
                    success:function (data) {
                        if(data==1){
                            alert("该用户已经存在，请勿重复注册！");
                        }
                        if (data==2){
                            alert("验证码输入有误！");
                        }
                        else{
                            alert("注册成功！点击确定回到首页 即可登陆。");
                            window.location.href="../locationTo/bbbf";
                        }
                    }

                })
            }
        }else {
            alert("未全部正确填写！");
        }
    });
    //登陆 方法
    $("#signin_btn").click(function(){
        if(quanju){ //  quanju=true;
            $(".aa").each(function(){
                $(".aa").trigger("blur");
            });
            if(quanju==true){
                $.ajax({
                    type:'post',
                    url:'../beforeUserLogin/CodeCheck',
                    dataType:"json",
                    data:{"username":$('#userid').val(),
                        "password":$('#passwordinput').val(),
                        "invite":$('#verifyCode').val(),
                        // "reenterpassword":$('#reenterpassword').val(),
                        // "letterCode":$('#letterCode').val()
                    },
                    success:function (data) {
                        if(data==1){
                            //  alert("该用户已经存在，请勿重复注册！");
                            window.location.href="../locationTo/bbbf";
                        }
                        if (data==0){
                            alert("输入有误！请检查确认！");
                        }

                    }

                })
            }
        }
    });
</script>
</body>
</html>
