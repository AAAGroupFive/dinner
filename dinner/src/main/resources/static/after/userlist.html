<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>商品列表</title>
    <link rel="stylesheet" href="../lib/layui/css/layui.css">
    <script src="../lib/layui/layui.js" charset="utf-8"></script>
    <script src="../js/jquery.min.js"></script>

    <style type="text/css">
        .layui-table-cell .layui-form-checkbox[lay-skin="primary"] {
            top: 50%;
            transform: translateY(-50%);
        }
    </style>
</head>
<body>
<table class="layui-hide" id="userlist" lay-filter="demo" >
    <div class="demoTable" style="margin-top: 10px;width: 1662px;margin-left: 20px;">
        <!--<div class="layui-btn" data-type="reload" id="redo"><i class="layui-icon">&#xe669;</i></div>-->
        <div class="layui-btn layui-btn-warm" style="margin-left:10px;" onclick="toAdd()"><i class="layui-icon">&#xe608;</i>添加</div>
    </div>
</table>
<script>
    layui.use('table', function() {
        var table = layui.table;
        table.render({
            elem: '#userlist'
            , title: '商品信息表'
            , height: 790
            , width: 1743
            , url: '../emp/list'
            , toolbar: '#toolbarDemo'
            , page: true
            , even: true
            , skin:'nob'    //line （行边框风格） row （列边框风格） nob （无边框风格）
            , size: 'lg'
            , cols: [ [
                {field: 'EMPID', title: '雇员id', width: 100, sort: true, unresize: true, fixed: true}
                , {field: 'EMPNAME', title: '姓名', width: 100}
                , {field: 'USERNAME', title: '用户名', width: 100}
                , {field: 'PASSWORD', title: '密码', width: 100}
                , {field: 'SEX', title: '性别', width: 100,templet:'#sex'}
                , {field: 'BIRTH', title: '年龄', width: 100}
                , {field: 'PHONE', title: '电话', width: 150}
                , {field: 'ADDR', title: '地址', width: 200}
                , {field: 'ROLE', title: '职位', width: 100,templet:'#zhi'}
                , {fixed: 'right',title: '操作', toolbar: '#barDemo', width: 200}
            ] ]
            , request:{
                pageName:'pageNo',//页码的参数名称，默认：page
                limitName:'pageSize'//每页数据量的参数名：默认：limit
            },
            limits:[5,10,15],  //显示
            limit:10  //每页默认显示的数量
            //隐藏id
            , done: function () {
                $("[data-field='EMPID']").css('display', 'none');
            }
        })
        //监听工具条
        table.on('tool(demo)', function(obj){
            var data = obj.data;
            if(obj.event === 'del'){
                layer.confirm('确定要删除吗', function(index){
                    $.ajax({
                        url: "../emp/del",
                        type: "post",
                        data:{"EMPID":data.EMPID},
                        dataType: "json",
                        success: function(data){
                            if(data.issuc==true){
                                obj.del();
                                layer.close(index);
                                layer.msg("删除成功", {icon: 6});
                                location.reload();
                            }else{
                                layer.msg("删除失败", {icon: 5});
                            }
                        }
                    });//ajax
                });
            } else if(obj.event === 'edit'){
                layer.open({
                    title: '修改用户信息'
                    ,type: 1
                    ,area: ['500px', '440px']
                    ,anim: 1
                    ,content:$("#editDemo").html()
                    ,success:function(layero,index){
                        var nodes=layero[0];
                        $("#EMPID").val(data.EMPID);
                        $("#USERNAME").val(data.USERNAME);
                        $("#PASSWORD").val(data.PASSWORD);
                        $("#PHONE").val(data.PHONE);
                        $("#ADDR").val(data.ADDR);
                        $("#ROLE").val(data.ROLE);
                        $("#sbt").click(function(){
                            $.ajax({
                                url: "../emp/update",
                                type: "post",
                                data:{
                                    "EMPID":data.EMPID,"USERNAME":$("#USERNAME").val(),
                                    "PASSWORD":$("#PASSWORD").val(),"PHONE":$("#PHONE").val(),
                                    "ADDR":$("#ADDR").val(),"ROLE":$("#ROLE").val()
                                },
                                dataType: "json",
                                success: function(data){
                                    //获取当前的页码
                                    var pageNum = $(".layui-laypage-curr .layui-laypage-em").next().html();
                                    if(data.issuc==true){
                                        layer.close(index);
                                        layer.msg("修改成功", {icon: 6});
                                        setTimeout(function () {
                                            //修改页码input框的值为当前页码
                                            //$(".layui-laypage-skip .layui-input").val(pageNum);
                                            //触发页码确定按钮 实现只刷新当前页面
                                            location.reload();
                                        }, 700);
                                    }else{
                                        layer.msg("修改失败", {icon: 5});
                                    }
                                }   //success
                            });  //ajax
                        });  //#sbt
                        //弹出层取消按钮
                        $("#cancel").click(function(){
                            layer.closeAll('page');
                            location.reload();
                        })
                    }  //success(layero)
                }) //open
            }  //edit
        });
    })
</script>
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑<i class="layui-icon">&#xe642;</i></a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除<i class="layui-icon">&#xe640;</i></a>
</script>
<script type="text/html" id="sex">
    {{# if (d.SEX=== 0) { }}
    <a>男</a>
    {{# } else if(d.SEX=== 1) { }}
    <a>女</a>
    {{# } }}
</script>
<script type="text/html" id="zhi">
    {{# if (d.ROLE=== 0) { }}
    <a>服务员</a>
    {{# } else if(d.ROLE=== 1) { }}
    <a>收银</a>
    {{# } else if(d.ROLE=== 2) { }}
    <a>仓库</a>
    {{# } else if(d.ROLE=== 3) { }}
    <a>老板</a>
    {{# } }}
</script>
<script>
    function toAdd() {
        location.href="/dinner/emp/toAdd"
    }
</script>
</body>
</html>
